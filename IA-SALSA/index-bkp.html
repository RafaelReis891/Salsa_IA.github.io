<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jarvis Voice AI</title>
<style>
    body {
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at center, #0d47a1, #001f3f);
        font-family: Arial, sans-serif;
        color: white;
        text-align: center;
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #aiButton {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        border: 3px solid #00e5ff;
        background: rgba(0, 150, 255, 0.2);
        box-shadow: 0 0 20px #00e5ff, inset 0 0 30px #00e5ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        cursor: pointer;
        transition: 0.2s ease;
    }

    #aiButton.listening {
        animation: pulse 1s infinite;
        background: rgba(0, 200, 255, 0.4);
        box-shadow: 0 0 30px #00e5ff, inset 0 0 40px #00e5ff;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    #falado, #resultado {
        margin-top: 20px;
        max-width: 80%;
        font-size: 18px;
        text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
</style>
</head>
<body>

<div class="container">
    <div id="aiButton" onclick="startRec()">IA</div>

    <p id="falado"></p>
    <p id="resultado"></p>
</div>

<script>
const perguntas = [
    "qual √© o hor√°rio de funcionamento da cl√≠nica durante os finais de semana",
    "como posso recuperar minha senha se eu n√£o tiver mais acesso ao meu e-mail",
    "quais s√£o os documentos necess√°rios para realizar o cadastro na plataforma",
    "em quais condi√ß√µes o reembolso pode ser solicitado pelo usu√°rio",
    "qual √© o procedimento correto para agendar uma consulta online"
];

// ---- Fala da IA ----
function falar(texto) {
    const msg = new SpeechSynthesisUtterance(texto);
    msg.lang = "pt-BR";
    msg.rate = 3;  // velocidade
    msg.pitch = 0.5; // tom levemente mais "IA"
    speechSynthesis.speak(msg);
}

// ---- Jaro-Winkler ----
function jaroWinkler(s1, s2) {
    if (!s1 || !s2) return 0;
    const m = Math.floor(Math.max(s1.length, s2.length) / 2) - 1;
    let matches = 0, transpositions = 0;
    const s1Matches = [], s2Matches = [];

    for (let i = 0; i < s1.length; i++) {
        const start = Math.max(0, i - m);
        const end = Math.min(s2.length, i + m + 1);
        for (let j = start; j < end; j++) {
            if (!s2Matches[j] && s1[i] === s2[j]) {
                s1Matches[i] = s2Matches[j] = true;
                matches++;
                break;
            }
        }
    }

    if (matches === 0) return 0;

    let k = 0;
    for (let i = 0; i < s1.length; i++) {
        if (s1Matches[i]) {
            while (!s2Matches[k]) k++;
            if (s1[i] !== s2[k]) transpositions++;
            k++;
        }
    }

    const jaro = (1/3) * (
        matches/s1.length +
        matches/s2.length +
        (matches - transpositions/2) / matches
    );

    let prefix = 0;
    for (let i = 0; i < Math.min(4, s1.length, s2.length); i++) {
        if (s1[i] === s2[i]) prefix++;
        else break;
    }

    return jaro + prefix * 0.1 * (1 - jaro);
}

function encontrarPergunta(texto) {
    let melhor = null, maiorScore = 0;
    perguntas.forEach(p => {
        const score = jaroWinkler(texto, p);
        if (score > maiorScore) {
            maiorScore = score;
            melhor = p;
        }
    });
    return { melhor, maiorScore };
}

// ---- Reconhecimento ----
const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
rec.lang = "pt-BR";
rec.interimResults = false;

rec.onstart = () => {
    document.getElementById("aiButton").classList.add("listening");
};

rec.onend = () => {
    document.getElementById("aiButton").classList.remove("listening");
};

rec.onresult = (event) => {
    const texto = event.results[0][0].transcript.toLowerCase();
    document.getElementById("falado").innerText = "üó£ Voc√™ disse: " + texto;

    const result = encontrarPergunta(texto);

    if (result.maiorScore >= 0.75) {
        document.getElementById("resultado").innerText =
            "‚úî Identificado: " + result.melhor + " (score " + result.maiorScore.toFixed(2) + ")";

        // IA fala a pergunta identificada
        falar("Voc√™ perguntou: " + result.melhor);

    } else {
        document.getElementById("resultado").innerText =
            "‚ùå Nada compat√≠vel. Maior score: " + result.maiorScore.toFixed(2);

        // IA d√° resposta de erro
        falar("N√£o consegui identificar sua pergunta.");
    }
};

function startRec() {
    rec.start();
}
</script>

</body>
</html>
