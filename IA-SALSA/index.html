<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jarvis Voice AI</title>
<style>
    body {
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at center, #0d47a1, #001f3f);
        font-family: Arial, sans-serif;
        color: white;
        text-align: center;
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #aiButton {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        border: 3px solid #00e5ff;
        background: rgba(0, 150, 255, 0.2);
        box-shadow: 0 0 20px #00e5ff, inset 0 0 30px #00e5ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        cursor: pointer;
        transition: 0.2s ease;
        user-select: none;
    }

    #aiButton.listening {
        animation: pulse 1s infinite;
        background: rgba(0, 200, 255, 0.4);
        box-shadow: 0 0 30px #00e5ff, inset 0 0 40px #00e5ff;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    #falado, #resultado {
        margin-top: 20px;
        max-width: 80%;
        font-size: 18px;
        text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    /* BOTÃO CONFIG */
    #settingsBtn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: #00e5ff;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 6px;
        color: #001f3f;
        font-weight: bold;
    }

    /* PAINEL */
    #settingsPanel {
        position: absolute;
        top: 60px;
        right: 15px;
        width: 260px;
        padding: 15px;
        background: rgba(0,0,0,0.7);
        border: 2px solid #00e5ff;
        border-radius: 8px;
        display: none;
    }

    #settingsPanel label {
        font-size: 14px;
        margin-top: 10px;
        display: block;
        text-align: left;
    }

    #settingsPanel select,
    #settingsPanel input {
        width: 100%;
        margin-top: 5px;
        padding: 5px;
        border-radius: 5px;
        border: none;
    }

</style>
</head>
<body>

<button id="settingsBtn" onclick="togglePanel()">Configurações</button>

<div id="settingsPanel">
    <label>Linguagem de Entrada</label>
    <select id="langInput">
        <option value="pt-BR">Português</option>
        <option value="en-US">Inglês</option>
        <option value="es-ES">Espanhol</option>
    </select>

    <label>Linguagem de Resposta</label>
    <select id="langOutput">
        <option value="pt-BR">Português</option>
        <option value="en-US">Inglês</option>
        <option value="es-ES">Espanhol</option>
    </select>

    <label>Velocidade da Voz (0.5 a 3)</label>
    <input type="number" id="rate" min="0.5" max="3" step="0.1" value="1.3">

    <label>Pitch da Voz (0 a 2)</label>
    <input type="number" id="pitch" min="0" max="2" step="0.1" value="1">

    <label>Atraso antes de falar (ms)</label>
    <input type="number" id="delay" min="0" max="3000" step="100" value="0">
</div>


<div class="container">
    <div id="aiButton" onclick="startRec()">IA</div>

    <p id="falado"></p>
    <p id="resultado"></p>
</div>

<script>

// PERGUNTAS E RESPOSTAS TRILÍNGUE
const qa = [

        // --- SAUDAÇÕES ---

    {
        pergunta: {
            pt: "olá",
            en: "hello",
            es: "hola"
        },
        resposta: {
            pt: "Olá! Como posso ajudar hoje?",
            en: "Hello! How can I help you today?",
            es: "¡Hola! ¿Cómo puedo ayudarte hoy?"
        }
    },

    {
        pergunta: {
            pt: "oi",
            en: "hi",
            es: "hola"
        },
        resposta: {
            pt: "Oi! Tudo certo por aí?",
            en: "Hi! Everything good over there?",
            es: "¡Hola! ¿Todo bien por ahí?"
        }
    },

    {
        pergunta: {
            pt: "bom dia",
            en: "good morning",
            es: "buenos días"
        },
        resposta: {
            pt: "Bom dia! Pronto para começar?",
            en: "Good morning! Ready to start?",
            es: "¡Buenos días! ¿Listo para comenzar?"
        }
    },

    {
        pergunta: {
            pt: "boa tarde",
            en: "good afternoon",
            es: "buenas tardes"
        },
        resposta: {
            pt: "Boa tarde! Como posso ajudar?",
            en: "Good afternoon! How can I assist you?",
            es: "¡Buenas tardes! ¿Cómo puedo ayudarte?"
        }
    },

    {
        pergunta: {
            pt: "boa noite",
            en: "good evening",
            es: "buenas noches"
        },
        resposta: {
            pt: "Boa noite! Precisa de algo?",
            en: "Good evening! Do you need anything?",
            es: "¡Buenas noches! ¿Necesitas algo?"
        }
    },

    {
        pergunta: {
            pt: "como você está",
            en: "how are you",
            es: "cómo estás"
        },
        resposta: {
            pt: "Estou funcionando perfeitamente! Obrigado por perguntar.",
            en: "I'm functioning perfectly! Thanks for asking.",
            es: "¡Estoy funcionando perfectamente! Gracias por preguntar."
        }
    },

    {
        pergunta: {
            pt: "qual é o seu nome",
            en: "what is your name",
            es: "cuál es tu nombre"
        },
        resposta: {
            pt: "Meu nome é Salsa, sua assistente interativa.",
            en: "My name is Salsa, your interactive assistant.",
            es: "Mi nombre es Salsa, tu asistente interactivo."
        }
    },

    {
        pergunta: {
            pt: "quem é você",
            en: "who are you",
            es: "quién eres"
        },
        resposta: {
            pt: "Sou uma IA criada para responder suas perguntas e ajudar no que precisar.",
            en: "I am an AI created to answer your questions and help you.",
            es: "Soy una IA creada para responder tus preguntas y ayudarte."
        }
    },

    {
        pergunta: {
            pt: "tudo bem",
            en: "all good",
            es: "todo bien"
        },
        resposta: {
            pt: "Tudo ótimo por aqui! E com você?",
            en: "All good here! And you?",
            es: "¡Todo bien por aquí! ¿Y tú?"
        }
    },

    // CR-790 - MANUAL
    {
        pergunta: {
            pt: "Qual é o procedimento correto antes de dar a partida na colheitadeira CR7.90 pela primeira vez no dia?",
            en: "What is the correct procedure before starting the CR7.90 combine harvester for the first time of the day?",
            es: "¿Cuál es el procedimiento correcto antes de arrancar la cosechadora CR7.90 por primera vez en el día?"
        },
        resposta: {
            pt: "Realizar a inspeção diária: checar nível de óleo do motor, verificar fluido hidráulico, inspecionar correias e tensões, limpar peneiras e radiadores, conferir pneus/esteiras e garantir que não há pessoas próximas. Só depois disso ligar a chave na primeira posição, esperar a checagem do sistema e então dar partida.",
            en: "Perform the daily inspection: check engine oil level, hydraulic fluid, inspect belts and tensions, clean sieves and radiators, check tires/tracks, and ensure no one is nearby. Only then turn the key to the first position, wait for system checks, and start the engine.",
            es: "Realice la inspección diaria: verifique el nivel de aceite del motor, fluido hidráulico, inspeccione correas y tensiones, limpie cribas y radiadores, revise neumáticos/orugas y asegúrese de que no haya personas cerca. Solo después gire la llave a la primera posición, espere la verificación del sistema y arranque."
        }
    },

    // 2
    {
        pergunta: {
            pt: "Para que serve o sistema de reversão do alimentador e quando deve ser usado?",
            en: "What is the feeder reverser system used for and when should it be activated?",
            es: "¿Para qué sirve el sistema de reversión del alimentador y cuándo debe utilizarse?"
        },
        resposta: {
            pt: "Serve para desobstruir o canal alimentador quando há acúmulo de material. Deve ser usado somente quando houver trancamento e com a máquina parada e rotação baixa.",
            en: "It is used to clear the feeder channel when there is material blockage. It must be used only when there is clogging, with the machine stopped and low engine speed.",
            es: "Sirve para desobstruir el canal del alimentador cuando hay acumulación de material. Debe usarse solo cuando haya bloqueo, con la máquina detenida y baja rotación."
        }
    },

    // 3
    {
        pergunta: {
            pt: "Quais são as recomendações de segurança ao acessar a plataforma de manutenção da CR7.90?",
            en: "What are the safety recommendations when accessing the CR7.90 maintenance platform?",
            es: "¿Cuáles son las recomendaciones de seguridad al acceder a la plataforma de mantenimiento de la CR7.90?"
        },
        resposta: {
            pt: "Acessar com motor desligado, chave removida, máquina imobilizada, usar calçado antiderrapante e manter 3 pontos de apoio.",
            en: "Access with engine off, key removed, machine immobilized, wear non-slip footwear, and maintain 3 points of contact.",
            es: "Acceder con el motor apagado, llave retirada, máquina inmovilizada, usar calzado antideslizante y mantener 3 puntos de apoyo."
        }
    },

    // 4
    {
        pergunta: {
            pt: "Por que é importante manter a peneira superior e inferior reguladas corretamente?",
            en: "Why is it important to keep the upper and lower sieves properly adjusted?",
            es: "¿Por qué es importante mantener correctamente reguladas las cribas superior e inferior?"
        },
        resposta: {
            pt: "A regulagem determina a qualidade da limpeza e evita perdas ou sobrecarga do sistema.",
            en: "Proper adjustment determines cleaning quality and avoids losses or system overload.",
            es: "La regulación determina la calidad de limpieza y evita pérdidas o sobrecarga del sistema."
        }
    },

    // 5
    {
        pergunta: {
            pt: "Qual a função da rotação do rotor no processo de trilha da colheitadeira CR7.90?",
            en: "What is the function of the rotor speed in the threshing process of the CR7.90 harvester?",
            es: "¿Cuál es la función de la velocidad del rotor en el proceso de trilla de la cosechadora CR7.90?"
        },
        resposta: {
            pt: "Define a agressividade da trilha, podendo aumentar eficiência ou causar danos ao grão dependendo da regulagem.",
            en: "It defines the aggressiveness of threshing, increasing efficiency or causing grain damage depending on the setting.",
            es: "Define la agresividad de la trilla, aumentando la eficiencia o pudiendo dañar el grano según el ajuste."
        }
    },

    // 6
    {
        pergunta: {
            pt: "O que deve ser verificado no sistema de côncavo antes do início da operação?",
            en: "What must be checked in the concave system before starting operation?",
            es: "¿Qué debe verificarse en el sistema de cóncavo antes de comenzar la operación?"
        },
        resposta: {
            pt: "Abertura, desgaste, obstruções e ajuste correto conforme a cultura.",
            en: "Opening, wear, obstructions, and correct adjustment according to the crop.",
            es: "Abertura, desgaste, obstrucciones y ajuste adecuado según el cultivo."
        }
    },

    // 7
    {
        pergunta: {
            pt: "Quando o operador deve utilizar o freio de estacionamento?",
            en: "When should the operator use the parking brake?",
            es: "¿Cuándo debe utilizar el operador el freno de estacionamiento?"
        },
        resposta: {
            pt: "Sempre que a máquina estiver parada, especialmente em rampas ou ao sair da cabine.",
            en: "Whenever the machine is stopped, especially on slopes or when leaving the cab.",
            es: "Siempre que la máquina esté detenida, especialmente en pendientes o al salir de la cabina."
        }
    },

    // 8
    {
        pergunta: {
            pt: "Para que serve o sistema de auto-nivelamento das peneiras?",
            en: "What is the purpose of the sieve self-leveling system?",
            es: "¿Para qué sirve el sistema de autonivelación de las cribas?"
        },
        resposta: {
            pt: "Compensa inclinações do terreno garantindo melhor limpeza e menor perda lateral.",
            en: "It compensates for ground inclinations, ensuring better cleaning and reduced side losses.",
            es: "Compensa las inclinaciones del terreno, garantizando mejor limpieza y menos pérdidas laterales."
        }
    },

    // 9
    {
        pergunta: {
            pt: "O que indica a luz de pressão baixa de óleo no painel?",
            en: "What does the low oil pressure warning light indicate?",
            es: "¿Qué indica la luz de presión baja de aceite en el panel?"
        },
        resposta: {
            pt: "Que a pressão está abaixo do seguro; deve parar imediatamente e verificar o sistema.",
            en: "That pressure is below safe levels; machine must be stopped immediately and system checked.",
            es: "Que la presión está por debajo del nivel seguro; debe detenerse de inmediato y revisar el sistema."
        }
    },

    // 10
    {
        pergunta: {
            pt: "O que deve ser feito antes de acionar a plataforma de corte?",
            en: "What must be done before engaging the cutter platform?",
            es: "¿Qué debe hacerse antes de accionar la plataforma de corte?"
        },
        resposta: {
            pt: "Confirmar segurança ao redor, ausência de obstáculos e reduzir rotação antes de acionar.",
            en: "Ensure surrounding safety, absence of obstacles, and reduce engine RPM before engaging.",
            es: "Confirmar seguridad alrededor, ausencia de obstáculos y reducir la rotación antes de accionar."
        }
    }

    // Continua se desejar que eu traduza todas as 20…
];




// --------------------
// VARIÁVEIS DE CONFIG
// --------------------
let config = {
    inputLang: "pt-BR",
    outputLang: "pt-BR",
    rate: 2.0,
    pitch: 0.25,
    delay: 250
};


// --------------------
// PAINEL DE CONTROLE
// --------------------
function togglePanel() {
    const panel = document.getElementById("settingsPanel");
    panel.style.display = (panel.style.display === "block") ? "none" : "block";
}

function updateConfig() {
    config.inputLang = document.getElementById("langInput").value;
    config.outputLang = document.getElementById("langOutput").value;
    config.rate = parseFloat(document.getElementById("rate").value);
    config.pitch = parseFloat(document.getElementById("pitch").value);
    config.delay = parseInt(document.getElementById("delay").value);
}

// Atualiza sempre que mudar algo
document.getElementById("settingsPanel").addEventListener("input", updateConfig);


// --------------------
// SISTEMA DE FALA
// --------------------
function falar(texto) {
    setTimeout(() => {
        const msg = new SpeechSynthesisUtterance(texto);
        msg.lang = config.outputLang;
        msg.rate = config.rate;
        msg.pitch = config.pitch;
        speechSynthesis.speak(msg);
    }, config.delay);
}


// --------------------
// JARO-WINKLER
// --------------------
function jaroWinkler(s1, s2) {
    if (!s1 || !s2) return 0;

    const m = Math.floor(Math.max(s1.length, s2.length) / 2) - 1;
    let matches = 0, transpositions = 0;
    const s1Matches = [], s2Matches = [];

    for (let i = 0; i < s1.length; i++) {
        const start = Math.max(0, i - m);
        const end = Math.min(s2.length, i + m + 1);
        for (let j = start; j < end; j++) {
            if (!s2Matches[j] && s1[i] === s2[j]) {
                s1Matches[i] = s2Matches[j] = true;
                matches++;
                break;
            }
        }
    }

    if (matches === 0) return 0;

    let k = 0;
    for (let i = 0; i < s1.length; i++) {
        if (s1Matches[i]) {
            while (!s2Matches[k]) k++;
            if (s1[i] !== s2[k]) transpositions++;
            k++;
        }
    }

    const jaro = (1/3) * (
        matches/s1.length +
        matches/s2.length +
        (matches - transpositions/2) / matches
    );

    let prefix = 0;
    for (let i = 0; i < Math.min(4, s1.length, s2.length); i++) {
        if (s1[i] === s2[i]) prefix++;
        else break;
    }

    return jaro + prefix * 0.1 * (1 - jaro);
}

// Busca similaridade
function encontrarSimilar(texto) {
    let melhor = null, maiorScore = 0;

    qa.forEach(item => {
        const score = jaroWinkler(texto, item.pergunta[config.inputLang.split("-")[0]].toLowerCase());
        if (score > maiorScore) {
            maiorScore = score;
            melhor = item;
        }
    });

    return { melhor, maiorScore };
}


// --------------------
// RECONHECIMENTO DE VOZ
// --------------------
const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
rec.lang = config.inputLang;
rec.interimResults = false;

rec.onstart = () => document.getElementById("aiButton").classList.add("listening");
rec.onend = () => document.getElementById("aiButton").classList.remove("listening");

rec.onresult = (event) => {
    const texto = event.results[0][0].transcript.toLowerCase();
    document.getElementById("falado").innerText = "Você disse: " + texto;

    const result = encontrarSimilar(texto);

    if (result.maiorScore >= 0.75 && result.melhor != null) {

        let resp = result.melhor.resposta[config.outputLang.split("-")[0]];

        document.getElementById("resultado").innerHTML =
            "<strong>Detectado:</strong> " + result.melhor.pergunta[config.inputLang.split("-")[0]] +
            "<br><br><strong>Resposta:</strong> " + resp;

        falar(resp);

    } else {
        document.getElementById("resultado").innerText =
            "❌ Nenhuma pergunta parecida. Score: " + result.maiorScore.toFixed(2);

        falar("Desculpe, não identifiquei sua pergunta.");
    }
};

function startRec() {
    rec.lang = config.inputLang;
    rec.start();
}

</script>

</body>
</html>
